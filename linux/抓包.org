* 抓包

**  BPF（Berkeley Packet filter)
大部分的数据包嗅探软件都依赖使用BPF的libcap/WinPcap库。

使用BPF语法创建的过滤器被称为表达式，并且每个表达式包含一个或者多个原句。每个语句包含一个或者多个限定词，然后跟着一个ID名字或者数字

| 限定词 | 说明                         | 例子            |
|--------+------------------------------+-----------------|
| Type   | 这出名字或者数字所代表的意义 | host，net，port |
| Dir    | 指明传输方向是向前还是来自名字或者数字          | src，dst         |
| Proto  | 限定所要匹配的协议                    | ether，ip，tcp，udp，ftp |

*** 原句逻辑符
+ 连接运算符 与(&&)
+ 选择运算符 或(||)
+ 否定运算符 非(!)

#+BEGIN_EXAMPLE
  这个表达式只对源地址是192.168.0.10和源端口或者目标端口是80的流量进行捕获

  src 192.168.0.10 && port 80
#+END_EXAMPLE

**  主机名和地址过滤器
一般基于下列四种：
MAC地址，IPV4地址，IPv6地址，DNS主机名配置过滤规则

#+BEGIN_EXAMPLE
  1. host 172.16.16.169
  2. host 2001:db8:851q:370:7334
  3. host testvers32
  4. ether host 00-1a-a0-52-e2-a0
#+END_EXAMPLE

** 端口和协议过滤器
不仅可以基于主机过滤，您可以基于每个数据包的端口进行过滤。端口过滤通常被用来过滤使用已知端口的服务和应用
#+BEGIN_EXAMPLE
  1. (!)port 8080
     （不)捕获8080端口的数据包

  2. dst port 80
     只希望捕获前往HTTP80端口的数据包
#+END_EXAMPLE

** 协议过滤器
可以让你基于特定协议进行数据包过滤。这通常被用于那些不是应用层的不能简单地使用特定端口进行定义的协议。

** 协议域过滤器
BPF语法提供给我们一个强大功能就是我们可以通过检查协议头中的每一个字节创建基于这些数据的特殊过滤器。

#+BEGIN_EXAMPLE
  1. icmp[0] == 3
     得到代表目标不可打(类型3)信息的ICMP数据包，我们在我们的过滤器表达式中令其等于3

  2. icmp[0]==8||imcp[0]==0
     只想检查代表echo请求（类型8）或者echo回复(类型0）的icnp数据包，使用带有OR运算的两个原句。
#+END_EXAMPLE

** 捕获过滤器表达式样例
分析的成败很多时候取决于你能否编写出恰当的过滤器
常用的过滤器
| 过滤器                         | 说明                        |
|--------------------------------+-----------------------------|
| tcp[13]&32=32                  | 设置了URG位的TCP数据包      |
| tcp[13]&16==16                 | 设置了ACK位的TCP数据包      |
| tcp[13]&8==8                   | 设置了PSH位的TCP数据包      |
| tcp[13]&4==4                   | 设置了RST位的TCP数据包      |
| tcp[13]&2==2                   | 设置了SYN位的TCP数据包      |
| tcp[13]&1==1                   | 设置了FIN位的TCP数据包      |
| tcp[13]==18                    | TCP SYN-ACK数据包           |
| ether host 00:00:00:00:00:00   | 流入或者流出你MA地址的流量  |
| ！ether host 00:00:00:00:00:00 | 不流入或流出你MAC地址的流量 |
| broadcast                      | 仅广播流量                  |
| icmp                           | ICMP流量                    |
| icmp[0:2]==0x0301              | ICMP目标不可达，主机不可打  |
| ip                             | 仅ipv4流量                  |
| ip6                            | 仅IPv6流量                  |
| udp                            | 仅UDP流量                   | 
  
  
